#%RAML 1.0
title: Purchase Order Experience API
version: v1
baseUri: http://localhost:8084/api/v1

documentation:
  - title: Purchase Order Experience API
    content: |
      This Experience API provides a simplified endpoint for external consumers.
      It orchestrates the purchase order processing by calling System and Process APIs.
      It follows the Experience API layer pattern in MuleSoft's three-layer architecture.
      This API is used specifically for Flipkart to IBM integration.

types:
  SubmitOrderRequest:
    type: object
    properties:
      orderId:
        type: string
        required: true
        example: "FK123456789"
        description: Order ID from Flipkart system
      processImmediate:
        type: boolean
        required: false
        default: true
        example: true
        description: Whether to process the order immediately or queue for later processing
      notificationEmail:
        type: string
        required: false
        example: "admin@company.com"
        description: Email address for processing notifications

  SubmitOrderResponse:
    type: object
    properties:
      requestId:
        type: string
        required: true
        example: "REQ_123456789"
        description: Unique request identifier
      status:
        type: string
        enum: [ACCEPTED, REJECTED, QUEUED]
        required: true
        example: "ACCEPTED"
        description: Initial processing status
      message:
        type: string
        required: true
        example: "Order submitted successfully for processing"
        description: Human-readable status message
      orderId:
        type: string
        required: true
        example: "FK123456789"
        description: Source order ID
      estimatedProcessingTime:
        type: string
        required: false
        example: "5 minutes"
        description: Estimated time for order processing completion
      submittedAt:
        type: datetime
        required: true
        example: "2024-01-15T10:30:00.000Z"
        description: Timestamp when order was submitted

  OrderStatusResponse:
    type: object
    properties:
      requestId:
        type: string
        required: true
        example: "REQ_123456789"
      orderId:
        type: string
        required: true
        example: "FK123456789"
      processingStatus:
        type: string
        enum: [PENDING, PROCESSING, COMPLETED, FAILED, CANCELLED]
        required: true
        example: "COMPLETED"
      statusMessage:
        type: string
        required: true
        example: "Order processed and sent to IBM successfully"
      submittedAt:
        type: datetime
        required: true
        example: "2024-01-15T10:30:00.000Z"
      processedAt:
        type: datetime
        required: false
        example: "2024-01-15T10:35:00.000Z"
      targetOrderId:
        type: string
        required: false
        example: "IBM_FK123456789"
        description: Order ID in target system (IBM)
      processingDetails:
        type: object
        required: false
        properties:
          transactionId:
            type: string
            example: "TXN_123456789"
          source:
            type: string
            example: "FLIPKART"
          target:
            type: string
            example: "IBM"
          recordsProcessed:
            type: integer
            example: 1
      errors:
        type: array
        required: false
        items:
          type: object
          properties:
            errorCode:
              type: string
              example: "EXP_001"
            errorMessage:
              type: string
              example: "Validation error in customer details"
            field:
              type: string
              example: "customerInfo.email"
            severity:
              type: string
              enum: [LOW, MEDIUM, HIGH, CRITICAL]
              example: "HIGH"

  BulkSubmitRequest:
    type: object
    properties:
      orderIds:
        type: array
        items:
          type: string
        required: true
        example: ["FK123456789", "FK123456790", "FK123456791"]
        description: Array of Flipkart order IDs to process
      batchName:
        type: string
        required: false
        example: "Daily_Batch_20240115"
        description: Optional batch identifier
      notificationEmail:
        type: string
        required: false
        example: "admin@company.com"
        description: Email address for batch processing notifications

  BulkSubmitResponse:
    type: object
    properties:
      batchId:
        type: string
        required: true
        example: "BATCH_123456789"
        description: Unique batch identifier
      status:
        type: string
        enum: [ACCEPTED, REJECTED, PARTIAL_ACCEPTED]
        required: true
        example: "ACCEPTED"
      message:
        type: string
        required: true
        example: "Batch submitted successfully for processing"
      totalOrders:
        type: integer
        required: true
        example: 3
        description: Total number of orders in the batch
      acceptedOrders:
        type: integer
        required: true
        example: 3
        description: Number of orders accepted for processing
      rejectedOrders:
        type: integer
        required: true
        example: 0
        description: Number of orders rejected
      submittedAt:
        type: datetime
        required: true
        example: "2024-01-15T10:30:00.000Z"
      estimatedCompletionTime:
        type: string
        required: false
        example: "15 minutes"

  ErrorResponse:
    type: object
    properties:
      errorCode:
        type: string
        required: true
        example: "EXP_001"
      errorMessage:
        type: string
        required: true
        example: "Invalid order ID format"
      timestamp:
        type: datetime
        required: true
        example: "2024-01-15T10:30:00Z"
      requestId:
        type: string
        required: false
        example: "REQ_123456789"

/orders:
  post:
    description: Submit a single Flipkart order for processing to IBM
    body:
      application/json:
        type: SubmitOrderRequest
        examples:
          single-order:
            orderId: "FK123456789"
            processImmediate: true
            notificationEmail: "admin@company.com"
    responses:
      200:
        body:
          application/json:
            type: SubmitOrderResponse
            examples:
              success-response:
                requestId: "REQ_123456789"
                status: "ACCEPTED"
                message: "Order submitted successfully for processing"
                orderId: "FK123456789"
                estimatedProcessingTime: "5 minutes"
                submittedAt: "2024-01-15T10:30:00.000Z"
      400:
        body:
          application/json:
            type: ErrorResponse
      422:
        body:
          application/json:
            type: ErrorResponse
      500:
        body:
          application/json:
            type: ErrorResponse

  /bulk:
    post:
      description: Submit multiple Flipkart orders for batch processing to IBM
      body:
        application/json:
          type: BulkSubmitRequest
          examples:
            bulk-orders:
              orderIds: ["FK123456789", "FK123456790", "FK123456791"]
              batchName: "Daily_Batch_20240115"
              notificationEmail: "admin@company.com"
      responses:
        200:
          body:
            application/json:
              type: BulkSubmitResponse
              examples:
                success-response:
                  batchId: "BATCH_123456789"
                  status: "ACCEPTED"
                  message: "Batch submitted successfully for processing"
                  totalOrders: 3
                  acceptedOrders: 3
                  rejectedOrders: 0
                  submittedAt: "2024-01-15T10:30:00.000Z"
                  estimatedCompletionTime: "15 minutes"
        400:
          body:
            application/json:
              type: ErrorResponse
        422:
          body:
            application/json:
              type: ErrorResponse
        500:
          body:
            application/json:
              type: ErrorResponse

/status:
  /{requestId}:
    get:
      description: Get order processing status by request ID
      responses:
        200:
          body:
            application/json:
              type: OrderStatusResponse
              examples:
                completed-status:
                  requestId: "REQ_123456789"
                  orderId: "FK123456789"
                  processingStatus: "COMPLETED"
                  statusMessage: "Order processed and sent to IBM successfully"
                  submittedAt: "2024-01-15T10:30:00.000Z"
                  processedAt: "2024-01-15T10:35:00.000Z"
                  targetOrderId: "IBM_FK123456789"
                  processingDetails:
                    transactionId: "TXN_123456789"
                    source: "FLIPKART"
                    target: "IBM"
                    recordsProcessed: 1
        404:
          body:
            application/json:
              type: ErrorResponse
        500:
          body:
            application/json:
              type: ErrorResponse

  /batch/{batchId}:
    get:
      description: Get batch processing status by batch ID
      responses:
        200:
          body:
            application/json:
              type: object
              properties:
                batchId:
                  type: string
                  example: "BATCH_123456789"
                batchStatus:
                  type: string
                  enum: [PENDING, PROCESSING, COMPLETED, PARTIAL_COMPLETED, FAILED]
                  example: "COMPLETED"
                totalOrders:
                  type: integer
                  example: 3
                processedOrders:
                  type: integer
                  example: 3
                failedOrders:
                  type: integer
                  example: 0
                submittedAt:
                  type: datetime
                  example: "2024-01-15T10:30:00.000Z"
                completedAt:
                  type: datetime
                  example: "2024-01-15T10:45:00.000Z"
                orderStatuses:
                  type: array
                  items:
                    type: OrderStatusResponse
        404:
          body:
            application/json:
              type: ErrorResponse
        500:
          body:
            application/json:
              type: ErrorResponse

/health:
  get:
    description: Health check endpoint
    responses:
      200:
        body:
          application/json:
            example: |
              {
                "status": "UP",
                "dependencies": {
                  "flipkart-sysapi": "UP",
                  "process-api": "UP"
                },
                "timestamp": "2024-01-15T10:30:00Z"
              }
